2025-04-12 00:01:23,117 [INFO] Application starting up
2025-04-12 00:01:23,117 [DEBUG] Configuring request session with retry strategy
2025-04-12 00:01:23,117 [DEBUG] Setting up Streamlit page configuration
2025-04-12 00:01:23,454 [INFO] Stock input set to: AAPL
2025-04-12 00:01:23,454 [INFO] Selected time period: 1 Month (1mo)
2025-04-12 00:01:23,454 [DEBUG] Setting valid intervals based on selected period
2025-04-12 00:01:23,456 [INFO] Selected interval: 1 Week (1wk)
2025-04-12 00:01:23,456 [INFO] Selected chart type: Candlestick
2025-04-12 00:01:23,456 [DEBUG] Selected MA periods: [20, 50]
2025-04-12 00:01:23,468 [INFO] Performing initial data load
2025-04-12 00:01:23,469 [INFO] Updating data and charts
2025-04-12 00:01:23,471 [INFO] Fetching data for AAPL (period: 1mo, interval: 1wk)
2025-04-12 00:01:23,471 [DEBUG] Download attempt 1/3 for ticker AAPL
2025-04-12 00:01:23,471 [DEBUG] Entering history()
2025-04-12 00:01:23,473 [DEBUG] ('CREATE TABLE IF NOT EXISTS "_kv" ("key" VARCHAR(255) NOT NULL PRIMARY KEY, "value" VARCHAR(255)) WITHOUT ROWID', [])
2025-04-12 00:01:23,474 [DEBUG] ('SELECT "t1"."key", "t1"."value" FROM "_kv" AS "t1" WHERE ("t1"."key" = ?) LIMIT ? OFFSET ?', ['AAPL', 1, 0])
2025-04-12 00:01:23,474 [DEBUG]  Entering _fetch_ticker_tz()
2025-04-12 00:01:23,474 [DEBUG]   Entering get()
2025-04-12 00:01:23,474 [DEBUG] url=https://query2.finance.yahoo.com/v8/finance/chart/AAPL
2025-04-12 00:01:23,474 [DEBUG] params=frozendict.frozendict({'range': '1d', 'interval': '1d'})
2025-04-12 00:01:23,474 [DEBUG]    Entering _get_cookie_and_crumb()
2025-04-12 00:01:23,475 [DEBUG] cookie_mode = 'basic'
2025-04-12 00:01:23,475 [DEBUG]     Entering _get_cookie_and_crumb_basic()
2025-04-12 00:01:23,477 [DEBUG] ('CREATE TABLE IF NOT EXISTS "_cookieschema" ("strategy" VARCHAR(255) NOT NULL PRIMARY KEY, "fetch_date" DATETIME NOT NULL, "cookie_bytes" BLOB NOT NULL) WITHOUT ROWID', [])
2025-04-12 00:01:23,477 [DEBUG] ('SELECT "t1"."strategy", "t1"."fetch_date", "t1"."cookie_bytes" FROM "_cookieschema" AS "t1" WHERE ("t1"."strategy" = ?) LIMIT ? OFFSET ?', ['basic', 1, 0])
2025-04-12 00:01:23,477 [DEBUG] loaded persistent cookie
2025-04-12 00:01:23,479 [DEBUG] reusing cookie
2025-04-12 00:01:23,482 [DEBUG] Starting new HTTPS connection (1): query1.finance.yahoo.com:443
2025-04-12 00:01:24,497 [DEBUG] https://query1.finance.yahoo.com:443 "GET /v1/test/getcrumb HTTP/1.1" 429 23
2025-04-12 00:01:24,497 [DEBUG] Incremented Retry for (url='/v1/test/getcrumb'): Retry(total=4, connect=None, read=None, redirect=None, status=None)
2025-04-12 00:01:24,497 [DEBUG] Retry: /v1/test/getcrumb
2025-04-12 00:01:24,498 [DEBUG] Resetting dropped connection: query1.finance.yahoo.com
2025-04-12 00:01:24,679 [DEBUG] https://query1.finance.yahoo.com:443 "GET /v1/test/getcrumb HTTP/1.1" 429 23
2025-04-12 00:01:24,680 [DEBUG] Incremented Retry for (url='/v1/test/getcrumb'): Retry(total=3, connect=None, read=None, redirect=None, status=None)
2025-04-12 00:01:26,681 [DEBUG] Retry: /v1/test/getcrumb
2025-04-12 00:01:26,681 [DEBUG] Resetting dropped connection: query1.finance.yahoo.com
2025-04-12 00:01:26,854 [DEBUG] https://query1.finance.yahoo.com:443 "GET /v1/test/getcrumb HTTP/1.1" 429 23
2025-04-12 00:01:26,854 [DEBUG] Incremented Retry for (url='/v1/test/getcrumb'): Retry(total=2, connect=None, read=None, redirect=None, status=None)
2025-04-12 00:01:30,855 [DEBUG] Retry: /v1/test/getcrumb
2025-04-12 00:01:30,855 [DEBUG] Resetting dropped connection: query1.finance.yahoo.com
2025-04-12 00:01:31,029 [DEBUG] https://query1.finance.yahoo.com:443 "GET /v1/test/getcrumb HTTP/1.1" 429 23
2025-04-12 00:01:31,030 [DEBUG] Incremented Retry for (url='/v1/test/getcrumb'): Retry(total=1, connect=None, read=None, redirect=None, status=None)
2025-04-12 00:01:39,031 [DEBUG] Retry: /v1/test/getcrumb
2025-04-12 00:01:39,031 [DEBUG] Resetting dropped connection: query1.finance.yahoo.com
2025-04-12 00:01:39,516 [DEBUG] https://query1.finance.yahoo.com:443 "GET /v1/test/getcrumb HTTP/1.1" 429 23
2025-04-12 00:01:39,516 [DEBUG] Incremented Retry for (url='/v1/test/getcrumb'): Retry(total=0, connect=None, read=None, redirect=None, status=None)
2025-04-12 00:01:55,517 [DEBUG] Retry: /v1/test/getcrumb
2025-04-12 00:01:55,517 [DEBUG] Resetting dropped connection: query1.finance.yahoo.com
2025-04-12 00:01:56,000 [DEBUG] https://query1.finance.yahoo.com:443 "GET /v1/test/getcrumb HTTP/1.1" 429 23
2025-04-12 00:01:56,000 [ERROR] Failed to get ticker 'AAPL' reason: HTTPSConnectionPool(host='query1.finance.yahoo.com', port=443): Max retries exceeded with url: /v1/test/getcrumb (Caused by ResponseError('too many 429 error responses'))
2025-04-12 00:01:56,000 [DEBUG]  Exiting _fetch_ticker_tz()
2025-04-12 00:01:56,001 [DEBUG] AAPL: Yahoo GET parameters: {'range': '1mo', 'interval': '1wk', 'includePrePost': True, 'events': 'div,splits,capitalGains'}
2025-04-12 00:01:56,001 [DEBUG]  Entering get()
2025-04-12 00:01:56,001 [DEBUG] url=https://query2.finance.yahoo.com/v8/finance/chart/AAPL
2025-04-12 00:01:56,001 [DEBUG] params={'range': '1mo', 'interval': '1wk', 'includePrePost': True, 'events': 'div,splits,capitalGains'}
2025-04-12 00:01:56,001 [DEBUG]   Entering _get_cookie_and_crumb()
2025-04-12 00:01:56,001 [DEBUG] cookie_mode = 'basic'
2025-04-12 00:01:56,001 [DEBUG]    Entering _get_cookie_and_crumb_basic()
2025-04-12 00:01:56,002 [DEBUG] reusing cookie
2025-04-12 00:01:56,002 [DEBUG] reusing cookie
2025-04-12 00:01:56,003 [DEBUG] Resetting dropped connection: query1.finance.yahoo.com
2025-04-12 00:01:56,522 [DEBUG] https://query1.finance.yahoo.com:443 "GET /v1/test/getcrumb HTTP/1.1" 429 23
2025-04-12 00:01:56,523 [DEBUG] Incremented Retry for (url='/v1/test/getcrumb'): Retry(total=4, connect=None, read=None, redirect=None, status=None)
2025-04-12 00:01:56,523 [DEBUG] Retry: /v1/test/getcrumb
2025-04-12 00:01:56,523 [DEBUG] Resetting dropped connection: query1.finance.yahoo.com
2025-04-12 00:01:57,377 [DEBUG] https://query1.finance.yahoo.com:443 "GET /v1/test/getcrumb HTTP/1.1" 429 23
2025-04-12 00:01:57,377 [DEBUG] Incremented Retry for (url='/v1/test/getcrumb'): Retry(total=3, connect=None, read=None, redirect=None, status=None)
2025-04-12 00:01:59,379 [DEBUG] Retry: /v1/test/getcrumb
2025-04-12 00:01:59,379 [DEBUG] Resetting dropped connection: query1.finance.yahoo.com
2025-04-12 00:02:00,253 [DEBUG] https://query1.finance.yahoo.com:443 "GET /v1/test/getcrumb HTTP/1.1" 429 23
2025-04-12 00:02:00,254 [DEBUG] Incremented Retry for (url='/v1/test/getcrumb'): Retry(total=2, connect=None, read=None, redirect=None, status=None)
2025-04-12 00:02:04,255 [DEBUG] Retry: /v1/test/getcrumb
2025-04-12 00:02:04,255 [DEBUG] Resetting dropped connection: query1.finance.yahoo.com
2025-04-12 00:02:04,499 [DEBUG] https://query1.finance.yahoo.com:443 "GET /v1/test/getcrumb HTTP/1.1" 429 23
2025-04-12 00:02:04,500 [DEBUG] Incremented Retry for (url='/v1/test/getcrumb'): Retry(total=1, connect=None, read=None, redirect=None, status=None)
2025-04-12 00:02:12,501 [DEBUG] Retry: /v1/test/getcrumb
2025-04-12 00:02:12,501 [DEBUG] Resetting dropped connection: query1.finance.yahoo.com
2025-04-12 00:02:12,771 [DEBUG] https://query1.finance.yahoo.com:443 "GET /v1/test/getcrumb HTTP/1.1" 429 23
2025-04-12 00:02:12,771 [DEBUG] Incremented Retry for (url='/v1/test/getcrumb'): Retry(total=0, connect=None, read=None, redirect=None, status=None)
2025-04-12 00:02:28,772 [DEBUG] Retry: /v1/test/getcrumb
2025-04-12 00:02:28,772 [DEBUG] Resetting dropped connection: query1.finance.yahoo.com
2025-04-12 00:02:29,650 [DEBUG] https://query1.finance.yahoo.com:443 "GET /v1/test/getcrumb HTTP/1.1" 429 23
2025-04-12 00:02:29,652 [ERROR] AAPL: No price data found, symbol may be delisted (period=1mo)
2025-04-12 00:02:29,652 [DEBUG] Exiting history()
2025-04-12 00:02:29,652 [WARNING] Attempt 1: Empty data returned for AAPL
2025-04-12 00:02:29,652 [DEBUG] Download attempt 2/3 for ticker AAPL
2025-04-12 00:02:29,653 [DEBUG] Entering history()
2025-04-12 00:02:29,653 [DEBUG] ('SELECT "t1"."key", "t1"."value" FROM "_kv" AS "t1" WHERE ("t1"."key" = ?) LIMIT ? OFFSET ?', ['AAPL', 1, 0])
2025-04-12 00:02:29,654 [DEBUG]  Entering _fetch_ticker_tz()
2025-04-12 00:02:29,654 [DEBUG]   Entering get()
2025-04-12 00:02:29,654 [DEBUG] url=https://query2.finance.yahoo.com/v8/finance/chart/AAPL
2025-04-12 00:02:29,654 [DEBUG] params=frozendict.frozendict({'range': '1d', 'interval': '1d'})
2025-04-12 00:02:29,654 [DEBUG]    Entering _get_cookie_and_crumb()
2025-04-12 00:02:29,654 [DEBUG] cookie_mode = 'basic'
2025-04-12 00:02:29,655 [DEBUG]     Entering _get_cookie_and_crumb_basic()
2025-04-12 00:02:29,655 [DEBUG] reusing cookie
2025-04-12 00:02:29,655 [DEBUG] reusing cookie
2025-04-12 00:02:29,656 [DEBUG] Resetting dropped connection: query1.finance.yahoo.com
2025-04-12 00:02:30,553 [DEBUG] https://query1.finance.yahoo.com:443 "GET /v1/test/getcrumb HTTP/1.1" 429 23
2025-04-12 00:02:30,553 [DEBUG] Incremented Retry for (url='/v1/test/getcrumb'): Retry(total=4, connect=None, read=None, redirect=None, status=None)
2025-04-12 00:02:30,554 [DEBUG] Retry: /v1/test/getcrumb
2025-04-12 00:02:30,554 [DEBUG] Resetting dropped connection: query1.finance.yahoo.com
2025-04-12 00:02:31,396 [DEBUG] https://query1.finance.yahoo.com:443 "GET /v1/test/getcrumb HTTP/1.1" 429 23
2025-04-12 00:02:31,397 [DEBUG] Incremented Retry for (url='/v1/test/getcrumb'): Retry(total=3, connect=None, read=None, redirect=None, status=None)
2025-04-12 00:02:33,398 [DEBUG] Retry: /v1/test/getcrumb
2025-04-12 00:02:33,398 [DEBUG] Resetting dropped connection: query1.finance.yahoo.com
2025-04-12 00:02:34,020 [DEBUG] https://query1.finance.yahoo.com:443 "GET /v1/test/getcrumb HTTP/1.1" 429 23
2025-04-12 00:02:34,020 [DEBUG] Incremented Retry for (url='/v1/test/getcrumb'): Retry(total=2, connect=None, read=None, redirect=None, status=None)
2025-04-12 00:02:38,021 [DEBUG] Retry: /v1/test/getcrumb
2025-04-12 00:02:38,022 [DEBUG] Resetting dropped connection: query1.finance.yahoo.com
2025-04-12 00:02:38,871 [DEBUG] https://query1.finance.yahoo.com:443 "GET /v1/test/getcrumb HTTP/1.1" 429 23
2025-04-12 00:02:38,871 [DEBUG] Incremented Retry for (url='/v1/test/getcrumb'): Retry(total=1, connect=None, read=None, redirect=None, status=None)
2025-04-12 00:02:46,872 [DEBUG] Retry: /v1/test/getcrumb
2025-04-12 00:02:46,873 [DEBUG] Resetting dropped connection: query1.finance.yahoo.com
2025-04-12 00:02:47,124 [DEBUG] https://query1.finance.yahoo.com:443 "GET /v1/test/getcrumb HTTP/1.1" 429 23
2025-04-12 00:02:47,124 [DEBUG] Incremented Retry for (url='/v1/test/getcrumb'): Retry(total=0, connect=None, read=None, redirect=None, status=None)
2025-04-12 00:03:03,125 [DEBUG] Retry: /v1/test/getcrumb
2025-04-12 00:03:03,125 [DEBUG] Resetting dropped connection: query1.finance.yahoo.com
2025-04-12 00:03:04,089 [DEBUG] https://query1.finance.yahoo.com:443 "GET /v1/test/getcrumb HTTP/1.1" 429 23
2025-04-12 00:03:04,089 [ERROR] Failed to get ticker 'AAPL' reason: HTTPSConnectionPool(host='query1.finance.yahoo.com', port=443): Max retries exceeded with url: /v1/test/getcrumb (Caused by ResponseError('too many 429 error responses'))
2025-04-12 00:03:04,090 [DEBUG]  Exiting _fetch_ticker_tz()
2025-04-12 00:03:04,090 [DEBUG] AAPL: Yahoo GET parameters: {'range': '1mo', 'interval': '1wk', 'includePrePost': True, 'events': 'div,splits,capitalGains'}
2025-04-12 00:03:04,090 [DEBUG]  Entering get()
2025-04-12 00:03:04,090 [DEBUG] url=https://query2.finance.yahoo.com/v8/finance/chart/AAPL
2025-04-12 00:03:04,091 [DEBUG] params={'range': '1mo', 'interval': '1wk', 'includePrePost': True, 'events': 'div,splits,capitalGains'}
2025-04-12 00:03:04,091 [DEBUG]   Entering _get_cookie_and_crumb()
2025-04-12 00:03:04,091 [DEBUG] cookie_mode = 'basic'
2025-04-12 00:03:04,091 [DEBUG]    Entering _get_cookie_and_crumb_basic()
2025-04-12 00:03:04,091 [DEBUG] reusing cookie
2025-04-12 00:03:04,091 [DEBUG] reusing cookie
2025-04-12 00:03:04,092 [DEBUG] Resetting dropped connection: query1.finance.yahoo.com
2025-04-12 00:03:04,397 [DEBUG] https://query1.finance.yahoo.com:443 "GET /v1/test/getcrumb HTTP/1.1" 429 23
2025-04-12 00:03:04,397 [DEBUG] Incremented Retry for (url='/v1/test/getcrumb'): Retry(total=4, connect=None, read=None, redirect=None, status=None)
2025-04-12 00:03:04,399 [DEBUG] Retry: /v1/test/getcrumb
2025-04-12 00:03:04,399 [DEBUG] Resetting dropped connection: query1.finance.yahoo.com
2025-04-12 00:03:04,530 [DEBUG] https://query1.finance.yahoo.com:443 "GET /v1/test/getcrumb HTTP/1.1" 429 23
2025-04-12 00:03:04,531 [DEBUG] Incremented Retry for (url='/v1/test/getcrumb'): Retry(total=3, connect=None, read=None, redirect=None, status=None)
2025-04-12 00:03:06,532 [DEBUG] Retry: /v1/test/getcrumb
2025-04-12 00:03:06,532 [DEBUG] Resetting dropped connection: query1.finance.yahoo.com
2025-04-12 00:03:06,882 [DEBUG] https://query1.finance.yahoo.com:443 "GET /v1/test/getcrumb HTTP/1.1" 429 23
2025-04-12 00:03:06,882 [DEBUG] Incremented Retry for (url='/v1/test/getcrumb'): Retry(total=2, connect=None, read=None, redirect=None, status=None)
2025-04-12 00:03:10,883 [DEBUG] Retry: /v1/test/getcrumb
2025-04-12 00:03:10,883 [DEBUG] Resetting dropped connection: query1.finance.yahoo.com
2025-04-12 00:03:11,013 [DEBUG] https://query1.finance.yahoo.com:443 "GET /v1/test/getcrumb HTTP/1.1" 429 23
2025-04-12 00:03:11,013 [DEBUG] Incremented Retry for (url='/v1/test/getcrumb'): Retry(total=1, connect=None, read=None, redirect=None, status=None)
